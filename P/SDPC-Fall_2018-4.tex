Find all functions $f:\mathbb{R}\to\mathbb{R}$ such that \[f\left(f\left(x\right)-f\left(y\right)\right)+2f\left(xy\right)=x^2f\left(x\right)+f\left(y^2\right)\] for all real numbers $x,y$. (Note: $\mathbb{R}$ denotes the real numbers.)